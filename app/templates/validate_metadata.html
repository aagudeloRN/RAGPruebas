{% extends "base.html" %}

{% block title %}Validar Metadatos - Sistema de Inteligencia Aumentada{% endblock %}

{% block content %}
<div class="form-container">
    <h2>Validar y Completar Metadatos</h2>
    <p>Por favor, revisa y corrige los metadatos extraídos por la IA antes de procesar el documento.</p>

    <div id="pipeline-recommendation" class="message info" style="display: none;"></div>

    <form id="metadata-form" method="post">
        <fieldset>
            <legend>Información Básica</legend>
            <div class="form-group">
                <label for="title">Título del Documento <span class="required">*</span></label>
                <input type="text" id="title" name="title" value="{{ document.title or '' }}" required>
            </div>
            <div class="form-group">
                <label for="filename">Nombre del Archivo</label>
                <input type="text" id="filename" name="filename" value="{{ document.filename }}" disabled>
            </div>
        </fieldset>

        <fieldset>
            <legend>Detalles de Publicación</legend>
            <div class="form-group">
                <label for="publisher">Publicado por</label>
                <input type="text" id="publisher" name="publisher" value="{{ document.publisher or '' }}">
            </div>
            <div class="form-group">
                <label for="publication_year">Año de Publicación</label>
                <input type="number" id="publication_year" name="publication_year" value="{{ document.publication_year or '' }}">
            </div>
            <div class="form-group">
                <label for="language">Idioma</label>
                <input type="text" id="language" name="language" value="{{ document.language or '' }}">
            </div>
        </fieldset>

        <fieldset>
            <legend>Contenido y Clasificación</legend>
            <div class="form-group">
                <label for="summary">Resumen</label>
                <textarea id="summary" name="summary" rows="5">{{ document.summary or '' }}</textarea>
            </div>
            <div class="form-group">
                <label for="keywords">Palabras Clave (separadas por comas)</label>
                <input type="text" id="keywords" name="keywords" value="{{ document.keywords|join(', ') if document.keywords else '' }}">
            </div>
        </fieldset>

        <div class="action-buttons">
            <button type="submit" class="btn btn-primary">Guardar y Procesar</button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const pipelineRec = urlParams.get('pipeline_rec');
        const recommendationDiv = document.getElementById('pipeline-recommendation');
        const form = document.getElementById('metadata-form');
        const docId = "{{ document.id }}";

        if (pipelineRec === 'V2') {
            recommendationDiv.innerHTML = '<strong>Recomendación:</strong> Este documento parece complejo y contiene tablas. Se recomienda usar el <strong>Motor de Ingesta V2 (Avanzado)</strong>.';
            form.action = `/process-document-v2/${docId}`;
        } else {
            recommendationDiv.innerHTML = '<strong>Recomendación:</strong> Este documento parece simple. Se recomienda usar el <strong>Motor de Ingesta V1 (Rápido)</strong>.';
            form.action = `/process-document/${docId}`;
        }
        recommendationDiv.style.display = 'block';
    });
</script>
{% endblock %}